#!/usr/bin/env coffee

Mailr = require '../lib/mailr'

nomnom = require 'nomnom'
nomnom.script('mailr')
nomnom.command('send')
  .options
    account:
      abbr: 'a'
      metavar: 'ACCOUNT'
      help: 'the account from which to send'
    emailFile:
      position: 1
      help: 'name of email file to send'
      required: true
  .help("send an email")
  .callback (opts) ->
    mailr = new Mailr()
    console.log "Sending..."
    mailr.send {filename: opts.emailFile, account: opts.account},
      (err, response) ->
        if err?
          console.log "ERROR: #{err}"
        else
          console.log response

nomnom.command('contacts')
  .options
    account:
      abbr: 'a'
      metavar: 'ACCOUNT'
      help: 'the account from which to send'
    update:
      abbr: 'u'
      flag: true
      help: 'updates the local contacts file'
  .help("gets the contacts")
  .callback (opts) ->
    mailr = new Mailr()
    if opts.update
      mailr.updateContacts opts.account, (err, contacts) ->
        if err?
          console.log "ERROR: #{err}"
        else
          for contact in contacts
            console.log contact


nomnom.parse()
